import{_ as s,c as a,d as l,o as e}from"./app-nJSYOaSR.js";const t={};function n(h,i){return e(),a("div",null,i[0]||(i[0]=[l(`<h2 id="有关-wsl-的网络代理" tabindex="-1"><a class="header-anchor" href="#有关-wsl-的网络代理"><span>有关 WSL 的网络代理</span></a></h2><p>由于 WSL 默认使用 NAT 网络模式：<code>检测到 localhost 代理配置，但未镜像到 WSL。NAT 模式下的 WSL 不支持 localhost 代理</code>，为了在 WSL 中使用代理以完成某些操作，需要对 WSL 进行一些配置。</p><p>在 Windows <code>%USERFILE%</code>目录下，新建 <code>.wslconfig</code> 配置文件，并加入以下配置：</p><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" style="--shiki-light:#657B83;--shiki-dark:#839496;--shiki-light-bg:#FDF6E3;--shiki-dark-bg:#002B36;"><pre class="shiki shiki-themes solarized-light solarized-dark vp-code"><code class="language-ini"><span class="line"><span style="--shiki-light:#657B83;--shiki-dark:#839496;">[wsl2]                      </span><span style="--shiki-light:#93A1A1;--shiki-light-font-style:italic;--shiki-dark:#586E75;--shiki-dark-font-style:italic;"># 核心配置</span></span>
<span class="line"><span style="--shiki-light:#859900;--shiki-dark:#859900;">autoProxy</span><span style="--shiki-light:#657B83;--shiki-dark:#839496;">=true            </span><span style="--shiki-light:#93A1A1;--shiki-light-font-style:italic;--shiki-dark:#586E75;--shiki-dark-font-style:italic;"># 是否强制 WSL2/WSLg 子系统使用 Windows 代理设置（请根据实际需要启用）</span></span>
<span class="line"><span style="--shiki-light:#859900;--shiki-dark:#859900;">dnsTunneling</span><span style="--shiki-light:#657B83;--shiki-dark:#839496;">=true          </span><span style="--shiki-light:#93A1A1;--shiki-light-font-style:italic;--shiki-dark:#586E75;--shiki-dark-font-style:italic;"># WSL2/WSLg DNS 代理隧道，以便由 Windows 代理转发 DNS 请求（请根据实际需要启用）</span></span>
<span class="line"><span style="--shiki-light:#859900;--shiki-dark:#859900;">firewall</span><span style="--shiki-light:#657B83;--shiki-dark:#839496;">=true               </span><span style="--shiki-light:#93A1A1;--shiki-light-font-style:italic;--shiki-dark:#586E75;--shiki-dark-font-style:italic;"># WSL2/WSLg 子系统的 Windows 防火墙集成，以便 Hyper-V 或者 Windows 筛选平台（WFP）能过滤子系统流量（请根据实际需要启用）</span></span>
<span class="line"><span style="--shiki-light:#859900;--shiki-dark:#859900;">guiApplications</span><span style="--shiki-light:#657B83;--shiki-dark:#839496;">=true        </span><span style="--shiki-light:#93A1A1;--shiki-light-font-style:italic;--shiki-dark:#586E75;--shiki-dark-font-style:italic;"># 启用 WSLg GUI 图形化程序支持</span></span>
<span class="line"><span style="--shiki-light:#859900;--shiki-dark:#859900;">ipv6</span><span style="--shiki-light:#657B83;--shiki-dark:#839496;">=true                   </span><span style="--shiki-light:#93A1A1;--shiki-light-font-style:italic;--shiki-dark:#586E75;--shiki-dark-font-style:italic;"># 启用 IPv6 网络支持</span></span>
<span class="line"><span style="--shiki-light:#93A1A1;--shiki-light-font-style:italic;--shiki-dark:#586E75;--shiki-dark-font-style:italic;"># localhostForwarding=true    # 启用 localhost 网络转发支持（新版已不支持在 mirrored 模式下使用，会自动忽略，所以无需注释掉，只是启用会有条烦人的警告而已）</span></span>
<span class="line"><span style="--shiki-light:#93A1A1;--shiki-light-font-style:italic;--shiki-dark:#586E75;--shiki-dark-font-style:italic;"># memory=4GB                  # 限制 WSL2/WSLg 子系统的最大内存占用</span></span>
<span class="line"><span style="--shiki-light:#93A1A1;--shiki-light-font-style:italic;--shiki-dark:#586E75;--shiki-dark-font-style:italic;"># processors=8                # 设置 WSL2/WSLg 子系统的逻辑 CPU 核心数为 8（最大肯定没法超过硬件的物理逻辑核心数）</span></span>
<span class="line"><span style="--shiki-light:#93A1A1;--shiki-light-font-style:italic;--shiki-dark:#586E75;--shiki-dark-font-style:italic;"># pageReporting=true          # 启用 WSL2/WSLg 子系统页面文件通报，以便 Windows 回收已分配但未使用的内存</span></span>
<span class="line"><span style="--shiki-light:#859900;--shiki-dark:#859900;">nestedVirtualization</span><span style="--shiki-light:#657B83;--shiki-dark:#839496;">=true   </span><span style="--shiki-light:#93A1A1;--shiki-light-font-style:italic;--shiki-dark:#586E75;--shiki-dark-font-style:italic;"># 启用 WSL2/WSLg 子系统嵌套虚拟化功能支持</span></span>
<span class="line"><span style="--shiki-light:#859900;--shiki-dark:#859900;">networkingMode</span><span style="--shiki-light:#657B83;--shiki-dark:#839496;">=mirrored     </span><span style="--shiki-light:#93A1A1;--shiki-light-font-style:italic;--shiki-dark:#586E75;--shiki-dark-font-style:italic;"># 启用镜像网络特性支持</span></span>
<span class="line"><span style="--shiki-light:#859900;--shiki-dark:#859900;">vmIdleTimeout</span><span style="--shiki-light:#657B83;--shiki-dark:#839496;">=-1            </span><span style="--shiki-light:#93A1A1;--shiki-light-font-style:italic;--shiki-dark:#586E75;--shiki-dark-font-style:italic;"># WSL2 VM 实例空闲超时关闭时间，-1 为永不关闭，根据参数说明，目前似乎仅适用于 Win11+</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#657B83;--shiki-dark:#839496;">[experimental]                  </span><span style="--shiki-light:#93A1A1;--shiki-light-font-style:italic;--shiki-dark:#586E75;--shiki-dark-font-style:italic;"># 实验性功能（按照过往经验，若后续转正，则是配置在上面的 [wsl2] 选节）</span></span>
<span class="line"><span style="--shiki-light:#859900;--shiki-dark:#859900;">autoMemoryReclaim</span><span style="--shiki-light:#657B83;--shiki-dark:#839496;">=gradual       </span><span style="--shiki-light:#93A1A1;--shiki-light-font-style:italic;--shiki-dark:#586E75;--shiki-dark-font-style:italic;"># 启用空闲内存自动缓慢回收，其它选项：dropcache / disabled（立即/禁用）</span></span>
<span class="line"><span style="--shiki-light:#859900;--shiki-dark:#859900;">hostAddressLoopback</span><span style="--shiki-light:#657B83;--shiki-dark:#839496;">=true        </span><span style="--shiki-light:#93A1A1;--shiki-light-font-style:italic;--shiki-dark:#586E75;--shiki-dark-font-style:italic;"># 启用 WSL2/WSLg 子系统和 Windows 宿主之间的本地回环互通支持</span></span>
<span class="line"><span style="--shiki-light:#859900;--shiki-dark:#859900;">sparseVhd</span><span style="--shiki-light:#657B83;--shiki-dark:#839496;">=true                  </span><span style="--shiki-light:#93A1A1;--shiki-light-font-style:italic;--shiki-dark:#586E75;--shiki-dark-font-style:italic;"># 启用 WSL2/WSLg 子系统虚拟硬盘空间自动回收</span></span>
<span class="line"><span style="--shiki-light:#859900;--shiki-dark:#859900;">bestEffortDnsParsing</span><span style="--shiki-light:#657B83;--shiki-dark:#839496;">=true       </span><span style="--shiki-light:#93A1A1;--shiki-light-font-style:italic;--shiki-dark:#586E75;--shiki-dark-font-style:italic;"># 和 dnsTunneling 配合使用，Windows 将从 DNS 请求中提取问题并尝试解决该问题，从而忽略未知记录（请根据实际需要启用）</span></span>
<span class="line"><span style="--shiki-light:#93A1A1;--shiki-light-font-style:italic;--shiki-dark:#586E75;--shiki-dark-font-style:italic;"># useWindowsDnsCache=false        # 和 dnsTunneling 配合使用，决定是否使用 Windows DNS 缓存池（新版已移除此实验性功能，未能转正）</span></span>
<span class="line"><span style="--shiki-light:#93A1A1;--shiki-light-font-style:italic;--shiki-dark:#586E75;--shiki-dark-font-style:italic;"># ignoredPorts=3306               # 见：https://learn.microsoft.com/zh-cn/windows/wsl/wsl-config#experimental-settings</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>完成后重启 Windows 使得改动生效</p><p>设置成功后在有代理时启动 WSL 将不再有提示信息，同时执行 <code>curl -I https://www/google.com</code> 会返回 <code>200</code> code。</p><h2 id="有关-wsl-与-ssh" tabindex="-1"><a class="header-anchor" href="#有关-wsl-与-ssh"><span>有关 WSL 与 SSH</span></a></h2><p>通过 SSH 远程访问 WSL 实现远程办公</p><ol><li><p>Zerotier 内网穿透</p><ul><li>在 WSL 中下载 Zerotier，并启动服务</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#657B83;--shiki-dark:#839496;--shiki-light-bg:#FDF6E3;--shiki-dark-bg:#002B36;"><pre class="shiki shiki-themes solarized-light solarized-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#268BD2;--shiki-dark:#268BD2;">sudo</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> systemctl</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> enable</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> zerotier-one</span></span>
<span class="line"><span style="--shiki-light:#268BD2;--shiki-dark:#268BD2;">sudo</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> systemctl</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> start</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> zerotier-one</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>加入 Zerotier 的网络</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#657B83;--shiki-dark:#839496;--shiki-light-bg:#FDF6E3;--shiki-dark-bg:#002B36;"><pre class="shiki shiki-themes solarized-light solarized-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#268BD2;--shiki-dark:#268BD2;">sudo</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> zerotier-cli</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> join</span><span style="--shiki-light:#859900;--shiki-dark:#859900;"> &lt;</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;">your-network-i</span><span style="--shiki-light:#657B83;--shiki-dark:#839496;">d</span><span style="--shiki-light:#859900;--shiki-dark:#859900;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>查看 Zerotier 状态</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#657B83;--shiki-dark:#839496;--shiki-light-bg:#FDF6E3;--shiki-dark-bg:#002B36;"><pre class="shiki shiki-themes solarized-light solarized-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#268BD2;--shiki-dark:#268BD2;">sudo</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> zerotier-cli</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> status</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>找到当前为 WSL 分配的虚拟地址</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#657B83;--shiki-dark:#839496;--shiki-light-bg:#FDF6E3;--shiki-dark-bg:#002B36;"><pre class="shiki shiki-themes solarized-light solarized-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#268BD2;--shiki-dark:#268BD2;">sudo</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> zerotier-cli</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> listnetworks</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>SSH 服务配置</p><ul><li>下载并启动 SSH 服务</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#657B83;--shiki-dark:#839496;--shiki-light-bg:#FDF6E3;--shiki-dark-bg:#002B36;"><pre class="shiki shiki-themes solarized-light solarized-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#268BD2;--shiki-dark:#268BD2;">sudo</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> service</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> ssh</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> start</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>检查 SSH 服务状态</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#657B83;--shiki-dark:#839496;--shiki-light-bg:#FDF6E3;--shiki-dark-bg:#002B36;"><pre class="shiki shiki-themes solarized-light solarized-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#268BD2;--shiki-dark:#268BD2;">sudo</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> service</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> ssh</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> status</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>修改 SSH 配置</p><ul><li>进入配置文件 <code>/etc/ssh/sshd_config</code></li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#657B83;--shiki-dark:#839496;--shiki-light-bg:#FDF6E3;--shiki-dark-bg:#002B36;"><pre class="shiki shiki-themes solarized-light solarized-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#268BD2;--shiki-dark:#268BD2;">sudo</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> nano</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> /etc/ssh/sshd_config</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>修改如下参数</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#657B83;--shiki-dark:#839496;--shiki-light-bg:#FDF6E3;--shiki-dark-bg:#002B36;"><pre class="shiki shiki-themes solarized-light solarized-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#268BD2;--shiki-dark:#268BD2;">Port</span><span style="--shiki-light:#D33682;--shiki-dark:#D33682;"> 22</span><span style="--shiki-light:#93A1A1;--shiki-light-font-style:italic;--shiki-dark:#586E75;--shiki-dark-font-style:italic;"> # 转发端口</span></span>
<span class="line"><span style="--shiki-light:#268BD2;--shiki-dark:#268BD2;">PermitRootLogin</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> prohibit-password</span><span style="--shiki-light:#93A1A1;--shiki-light-font-style:italic;--shiki-dark:#586E75;--shiki-dark-font-style:italic;"> # 允许 root 用户登录</span></span>
<span class="line"><span style="--shiki-light:#268BD2;--shiki-dark:#268BD2;">AllowUsers</span><span style="--shiki-light:#859900;--shiki-dark:#859900;"> &lt;</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;">user_nam</span><span style="--shiki-light:#657B83;--shiki-dark:#839496;">e</span><span style="--shiki-light:#859900;--shiki-dark:#859900;">&gt;</span><span style="--shiki-light:#93A1A1;--shiki-light-font-style:italic;--shiki-dark:#586E75;--shiki-dark-font-style:italic;"> # 允许一般用户登录</span></span>
<span class="line"><span style="--shiki-light:#268BD2;--shiki-dark:#268BD2;">PasswordAuthentocation</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> yes</span><span style="--shiki-light:#93A1A1;--shiki-light-font-style:italic;--shiki-dark:#586E75;--shiki-dark-font-style:italic;"> # 启用远程登录密码</span></span>
<span class="line"><span style="--shiki-light:#268BD2;--shiki-dark:#268BD2;">PermitUserEnvironment</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> yes</span><span style="--shiki-light:#93A1A1;--shiki-light-font-style:italic;--shiki-dark:#586E75;--shiki-dark-font-style:italic;"> # 允许用户环境</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>重新启动 SSH 服务</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#657B83;--shiki-dark:#839496;--shiki-light-bg:#FDF6E3;--shiki-dark-bg:#002B36;"><pre class="shiki shiki-themes solarized-light solarized-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#268BD2;--shiki-dark:#268BD2;">sudo</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> systemctl</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> restart</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> sshd</span></span>
<span class="line"><span style="--shiki-light:#268BD2;--shiki-dark:#268BD2;">sudo</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> service</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> ssh</span><span style="--shiki-light:#2AA198;--shiki-dark:#2AA198;"> restart</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>在 VSCode 中建立 Remote-SSH 连接</p><ul><li>用户名为 WSL 的用户名</li><li>密码为 sudo 密码</li></ul></li></ol>`,9)]))}const r=s(t,[["render",n]]),d=JSON.parse('{"path":"/papers/envtips","title":"一些环境配置的 Tips","lang":"zh-CN","frontmatter":{"title":"一些环境配置的 Tips","createTime":"2025/01/21 15:12:40","sticky":5,"permalink":"/papers/envtips","prev":{},"next":{},"description":"有关 WSL 的网络代理 由于 WSL 默认使用 NAT 网络模式：检测到 localhost 代理配置，但未镜像到 WSL。NAT 模式下的 WSL 不支持 localhost 代理，为了在 WSL 中使用代理以完成某些操作，需要对 WSL 进行一些配置。 在 Windows %USERFILE%目录下，新建 .wslconfig 配置文件，并加入以...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"一些环境配置的 Tips\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-05-23T11:04:23.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://velvet-notes.org/papers/envtips"}],["meta",{"property":"og:site_name","content":"Velvet-Notes"}],["meta",{"property":"og:title","content":"一些环境配置的 Tips"}],["meta",{"property":"og:description","content":"有关 WSL 的网络代理 由于 WSL 默认使用 NAT 网络模式：检测到 localhost 代理配置，但未镜像到 WSL。NAT 模式下的 WSL 不支持 localhost 代理，为了在 WSL 中使用代理以完成某些操作，需要对 WSL 进行一些配置。 在 Windows %USERFILE%目录下，新建 .wslconfig 配置文件，并加入以..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-05-23T11:04:23.000Z"}],["meta",{"property":"article:modified_time","content":"2025-05-23T11:04:23.000Z"}]]},"readingTime":{"minutes":2.95,"words":886},"git":{"createdTime":1737444376000,"updatedTime":1747998263000,"contributors":[{"name":"Velvet","username":"Velvet0314","email":"3131492575@qq.com","commits":4,"avatar":"https://image.velvet-notes.org/blog/avatar.png","url":"https://github.com/Velvet0314"}]},"autoDesc":true,"filePathRelative":"papers/envtips.md","headers":[],"categoryList":[{"id":"a566b2","sort":10000,"name":"papers"}]}');export{r as comp,d as data};
